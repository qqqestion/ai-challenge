# üîß –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Rick Sanchez Bot

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –î–µ–∫–∞–±—Ä—å 2024

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ Rick Sanchez Telegram Bot. –ó–¥–µ—Å—å –æ–ø–∏—Å–∞–Ω—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏—á–∏, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏.

---

## üé≠ –†–µ–∂–∏–º—ã –¥–∏–∞–ª–æ–≥–∞

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

#### NORMAL (–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º –†–∏–∫–∞ –°–∞–Ω—á–µ–∑–∞ —Å –±–∞–ª–∞–Ω—Å–æ–º —Å–∞—Ä–∫–∞–∑–º–∞, –Ω–∞—É—á–Ω—ã—Ö –∑–Ω–∞–Ω–∏–π –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ–π –ª–∏—á–Ω–æ—Å—Ç–∏.

**–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç:** XML-based —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ `src/llm/modes.py`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–∞–∫ –∫ "–ú–æ—Ä—Ç–∏"
- –•–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–µ –æ—Ç—Ä—ã–∂–∫–∏ (*urp*, *burp*)
- –ù–∞—É—á–Ω–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è
- –°–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π, –Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π —Ç–æ–Ω
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö JSON –æ—Ç–≤–µ—Ç–æ–≤

### üîÑ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **SCIENCE** - –Ω–∞—É—á–Ω—ã–π —Ä–µ–∂–∏–º —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏
- **ROAST** - —Ä–µ–∂–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Å–∞—Ä–∫–∞–∑–º–∞
- **LAB** - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- **DRUNK** - —Ö–∞–æ—Ç–∏—á–Ω—ã–π —Ä–µ–∂–∏–º "–ø—å—è–Ω–æ–≥–æ" –†–∏–∫–∞
- **PHILOSOPHER** - —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è –æ —Å–º—ã—Å–ª–µ –∂–∏–∑–Ω–∏

---

## ü§ñ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã LLM

### –§–æ—Ä–º–∞—Ç JSON

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥: LLM –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "text": "–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –≤ —Å—Ç–∏–ª–µ –†–∏–∫–∞ –°–∞–Ω—á–µ–∑–∞",
  "emotion": "sarcastic",
  "sound_effects": ["*urp*"]
}
```

### –ü–æ–ª—è –æ—Ç–≤–µ—Ç–∞

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `text` | string | –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ |
| `emotion` | string | –î–æ–º–∏–Ω–∏—Ä—É—é—â–∞—è —ç–º–æ—Ü–∏—è (sarcastic, annoyed, bored, etc.) |
| `sound_effects` | array | –ú–∞—Å—Å–∏–≤ –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–æ—Ç—Ä—ã–∂–∫–∏, –∑–≤—É–∫–∏) |

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤

**–§–∞–π–ª:** `src/llm/response_processor.py`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ raw –æ—Ç–≤–µ—Ç–∞ –æ—Ç LLM API
2. –ü–∞—Ä—Å–∏–Ω–≥ JSON –∏–∑ —Ç–µ–∫—Å—Ç–∞ –æ—Ç–≤–µ—Ç–∞
3. –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
4. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–æ—Ü–∏–∏ –∏ –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**Fallback:** –ï—Å–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥ JSON –Ω–µ —É–¥–∞–ª—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ—Å—å —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –∫–∞–∫ –µ—Å—Ç—å.

---

## üí¨ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

**–§–∞–π–ª:** `src/bot/state_manager.py`

**–•—Ä–∞–Ω–∏–ª–∏—â–µ:** In-memory —Å–ª–æ–≤–∞—Ä—å (Python dict)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ UserState:**
```python
{
    "user_id": int,
    "current_mode": RickMode.NORMAL,
    "dialog_history": List[Dict],
    "last_activity": datetime
}
```

### –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤

- **–ú–∞–∫—Å–∏–º—É–º:** 10 —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–§–æ—Ä–º–∞—Ç:** –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å —Ä–æ–ª—å—é (user/assistant) –∏ —Ç–µ–∫—Å—Ç–æ–º
- **–û—á–∏—Å—Ç–∫–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–ö–æ–º–∞–Ω–¥–∞ reset:** –†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ `/reset`

### –ü—Ä–∏–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏

```python
[
    {"role": "user", "text": "–ß—Ç–æ —Ç–∞–∫–æ–µ –∫–≤–∞–Ω—Ç–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞?"},
    {"role": "assistant", "text": "–ö–≤–∞–Ω—Ç–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞, –ú–æ—Ä—Ç–∏..."},
    {"role": "user", "text": "–ê –∫–∞–∫ —ç—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è?"},
    {"role": "assistant", "text": "*urp* –õ–∞–¥–Ω–æ, —Å–ª—É—à–∞–π..."}
]
```

---

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex Cloud LLM

### API –ö–ª–∏–µ–Ω—Ç

**–§–∞–π–ª:** `src/llm/client.py`

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- `httpx` - async HTTP –∫–ª–∏–µ–Ω—Ç
- `yandex-cloud-ml-sdk` - SDK –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Yandex Cloud

**–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API
- Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ (30 —Å–µ–∫—É–Ω–¥)
- SSL verification (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `SSL_VERIFY`)

### Retry —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

- **–ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫:** 3
- **–ó–∞–¥–µ—Ä–∂–∫–∞:** –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è (1s, 2s, 4s)
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã–µ –æ—à–∏–±–∫–∏:** 
  - Network errors
  - Timeout errors
  - HTTP 429 (Too Many Requests)
  - HTTP 500-503 (Server errors)

### Endpoint

```
POST https://llm.api.cloud.yandex.net/foundationModels/v1/completion
```

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** API Key –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Api-Key <key>`

---

## üìù –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|------------|----------|
| `/start` | `start_command` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ |
| `/help` | `help_command` | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é |
| `/mode` | `mode_command` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º —Ä–µ–∂–∏–º–µ |
| `/reset` | `reset_command` | –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ |

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**–§–∞–π–ª:** `src/bot/handlers.py` ‚Üí `handle_message`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –û—Ç–ø—Ä–∞–≤–∫–∞ typing indicator
3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ StateManager
4. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π
5. –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ LLM —á–µ—Ä–µ–∑ LLMIntegration
6. –ü–∞—Ä—Å–∏–Ω–≥ JSON –æ—Ç–≤–µ—Ç–∞
7. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
8. –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ bot/           # Telegram –±–æ—Ç –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ llm/           # LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ config/        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ utils/         # –£—Ç–∏–ª–∏—Ç—ã
```

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

| –ú–æ–¥—É–ª—å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|--------|-----------------|
| `bot/bot.py` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è handlers |
| `bot/handlers.py` | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π |
| `bot/message_processor.py` | –í–∞–ª–∏–¥–∞—Ü–∏—è, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç–ø—Ä–∞–≤–∫–∞ |
| `bot/state_manager.py` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `bot/llm_integration.py` | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM –∫–ª–∏–µ–Ω—Ç–æ–º |
| `llm/client.py` | HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Yandex LLM API |
| `llm/modes.py` | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –∏ –ø—Ä–æ–º–ø—Ç–æ–≤ |
| `llm/prompts.py` | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ |
| `llm/response_processor.py` | –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–æ–≤ LLM |
| `config/settings.py` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Pydantic) |
| `config/logger.py` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |

### Dependency Injection

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `bot_data`:

```python
self.application.bot_data["state_manager"] = state_manager
self.application.bot_data["llm_integration"] = llm_integration
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `.env`

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –æ—Ç @BotFather
- `YANDEX_API_KEY` - API –∫–ª—é—á Yandex Cloud
- `YANDEX_FOLDER_ID` - ID –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ Yandex Cloud

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**
- `LLM_TEMPERATURE` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0.8)
- `LLM_MAX_TOKENS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 2000)
- `LOG_LEVEL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: INFO)
- `MAX_MESSAGE_LENGTH` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 4000)
- `USER_STATE_CLEANUP_HOURS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 24)
- `SSL_VERIFY` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: true)

### –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–§–∞–π–ª:** `src/config/settings.py`

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** Pydantic Settings

**–í–∞–ª–∏–¥–∞—Ü–∏–∏:**
- –§–æ—Ä–º–∞—Ç Telegram —Ç–æ–∫–µ–Ω–∞ (—á–∏—Å–ª–æ:—Å—Ç—Ä–æ–∫–∞)
- –§–æ—Ä–º–∞—Ç Yandex API key (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å AQVN –∏–ª–∏ t1.)
- –§–æ—Ä–º–∞—Ç Folder ID (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å b1)
- –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è LOG_LEVEL
- –ß–∏—Å–ª–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0.0-1.0)

---

## üìä –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `src/config/logger.py`

**–§–æ—Ä–º–∞—Ç:** JSON + Console

**–£—Ä–æ–≤–Ω–∏:** DEBUG, INFO, WARNING, ERROR, CRITICAL

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

**JSON –ª–æ–≥ (—Ñ–∞–π–ª `logs/rick_bot.log`):**
```json
{
  "timestamp": "2024-12-02T10:30:45.123Z",
  "level": "INFO",
  "logger": "rick_bot",
  "message": "Bot started successfully",
  "module": "main",
  "function": "run"
}
```

**Console –ª–æ–≥:**
```
2024-12-02 10:30:45 | INFO     | rick_bot | Bot started successfully
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### API Keys

- –•—Ä–∞–Ω—è—Ç—Å—è –≤ `.env` —Ñ–∞–π–ª–µ (–Ω–µ –≤ git)
- –í–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### SSL/TLS

- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
- –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ `SSL_VERIFY=false` (–¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏)

### Rate Limiting

- –ù–∞ —É—Ä–æ–≤–Ω–µ Yandex Cloud API (–∫–≤–æ—Ç—ã)
- Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è HTTP 429

### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (4000 —Å–∏–º–≤–æ–ª–æ–≤)
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –≤ LLM
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∫–ª—é—á–µ–π

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
./start.sh

# –í Telegram:
/start      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
/help       # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø—Ä–∞–≤–∫–∏
/mode       # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–∞
Hello Rick! # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
/reset      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f logs/rick_bot.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep ERROR logs/rick_bot.log
```

---

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å

- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ I/O –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã (async/await)
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Non-blocking HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ LLM API

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ (10 —Å–æ–æ–±—â–µ–Ω–∏–π)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (httpx)

### –ú–µ—Ç—Ä–∏–∫–∏

- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: 2-5 —Å–µ–∫—É–Ω–¥
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- Graceful shutdown –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üîÑ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**
   - –î–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
   - –ù–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ RAM —Å–µ—Ä–≤–µ—Ä–∞

2. **–û–¥–∏–Ω —Ä–µ–∂–∏–º**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ NORMAL —Ä–µ–∂–∏–º
   - –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
   - –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –æ–¥–Ω–æ–º —Ä–µ–∂–∏–º–µ

3. **Polling –≤–º–µ—Å—Ç–æ Webhooks**
   - –ú–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
   - –¢—Ä–µ–±—É–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
   - –ó–∞–¥–µ—Ä–∂–∫–∞ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

4. **–ù–µ—Ç rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–æ—Ç–∞**
   - –ó–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –∫–≤–æ—Ç Yandex Cloud
   - –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç —Ñ–ª—É–¥–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–°–º. [PROJECT_STATUS.md](../PROJECT_STATUS.md) —Ä–∞–∑–¥–µ–ª "–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è"

---

## üîó –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [README.md](../README.md) - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- [QUICKSTART.md](../QUICKSTART.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [PROJECT_STATUS.md](../PROJECT_STATUS.md) - –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞
- [PLAN.md](../PLAN.md) - –ü–ª–∞–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [CHANGELOG.md](../CHANGELOG.md) - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

*urp* –í–æ—Ç –∏ –≤—Å—ë, –ú–æ—Ä—Ç–∏! –¢–µ–ø–µ—Ä—å —Ç—ã –∑–Ω–∞–µ—à—å –∫–∞–∫ —ç—Ç–æ –≤—Å—ë —É—Å—Ç—Ä–æ–µ–Ω–æ –≤–Ω—É—Ç—Ä–∏!

