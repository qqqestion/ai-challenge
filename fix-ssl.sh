#!/bin/bash

# ============================================
# Quick SSL Fix Script
# ============================================
# 
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç SSL_VERIFY=false –≤ .env
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É:
# "SSL: CERTIFICATE_VERIFY_FAILED"

set -e

# –¶–≤–µ—Ç–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

echo -e "${BLUE}"
cat << 'EOF'
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                       ‚ïë
‚ïë   üîí SSL Certificate Fix                             ‚ïë
‚ïë                                                       ‚ïë
‚ïë   –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤               ‚ïë
‚ïë                                                       ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
EOF
echo -e "${NC}"

echo ""
echo -e "${YELLOW}‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï:${NC}"
echo "–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –æ—Ç–∫–ª—é—á–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤."
echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¢–û–õ–¨–ö–û –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –ø—Ä–æ–∫—Å–∏."
echo ""
echo -e "${RED}–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ!${NC}"
echo ""

read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (y/n): " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "–û—Ç–º–µ–Ω–µ–Ω–æ."
    exit 0
fi

echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è .env
if [ ! -f ".env" ]; then
    echo -e "${RED}[ERROR]${NC} –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo ""
    echo "–°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª —Å–Ω–∞—á–∞–ª–∞:"
    echo "  touch .env"
    echo ""
    echo "–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ./start.sh –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è SSL_VERIFY
if grep -q "^SSL_VERIFY=" .env; then
    echo -e "${YELLOW}[INFO]${NC} SSL_VERIFY —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ .env"
    
    CURRENT_VALUE=$(grep "^SSL_VERIFY=" .env | cut -d'=' -f2)
    echo "–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: SSL_VERIFY=$CURRENT_VALUE"
    echo ""
    
    read -p "–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ SSL_VERIFY=false? (y/n): " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        # –ó–∞–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        if [[ "$OSTYPE" == "darwin"* ]]; then
            # macOS
            sed -i '' 's/^SSL_VERIFY=.*/SSL_VERIFY=false/' .env
        else
            # Linux
            sed -i 's/^SSL_VERIFY=.*/SSL_VERIFY=false/' .env
        fi
        echo -e "${GREEN}[SUCCESS]${NC} SSL_VERIFY –æ–±–Ω–æ–≤–ª–µ–Ω –≤ .env"
    else
        echo "–ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –≤–Ω–µ—Å–µ–Ω—ã."
        exit 0
    fi
else
    # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
    echo "" >> .env
    echo "# SSL Settings (–æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–∫—Å–∏)" >> .env
    echo "SSL_VERIFY=false" >> .env
    echo -e "${GREEN}[SUCCESS]${NC} SSL_VERIFY=false –¥–æ–±–∞–≤–ª–µ–Ω –≤ .env"
fi

echo ""
echo -e "${BLUE}[INFO]${NC} –ü—Ä–æ–≤–µ—Ä—è–µ–º .env —Ñ–∞–π–ª..."
echo ""
echo "–ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Å—Ç—Ä–æ–∫ .env:"
tail -5 .env
echo ""

echo -e "${YELLOW}‚ö†Ô∏è  –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:${NC}"
echo ""
echo "  ‚ö†Ô∏è  SSL VERIFICATION DISABLED"
echo "  SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ù–ï –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è!"
echo ""
echo "–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ."
echo ""

echo -e "${GREEN}‚úÖ –ì–æ—Ç–æ–≤–æ!${NC}"
echo ""
echo "–¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:"
echo "  ./start.sh"
echo ""
echo "–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ quick-run –µ—Å–ª–∏ venv —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:"
echo "  ./quick-run.sh"
echo ""

echo "üìñ –î–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è (—Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤):"
echo "   –°–º. SSL_FIX.md"
echo ""

